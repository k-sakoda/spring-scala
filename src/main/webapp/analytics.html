<!DOCTYPE html>
<html ng-app="MyApp">
<head lang="ja">
    <meta charset="UTF-8">
    <title>angulartics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ng-dialog/0.3.12/css/ngDialog.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ng-dialog/0.3.12/css/ngDialog-theme-default.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angulartics/0.17.2/angulartics.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angulartics/0.17.2/angulartics-ga.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ng-dialog/0.3.12/js/ngDialog.min.js"></script>
    <script>
      // optout_ga という cookieが保存されている場合はアクセスをトラッキングさせない
      if (/(^|;)\s*optout_ga=/.test(document.cookie)) {
        window['ga-disable-UA-50657-11'] = true;
      }
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-50657-11', 'auto');
    </script>
    <script>
      angular.module('MyApp', ['angulartics', 'angulartics.google.analytics', 'ngDialog'])
      .run([ "$rootScope", "$analytics","ngDialog",  function($scope, $analytics, ngDialog) {
        $scope.eventTrack = $analytics.eventTrack;

        $scope.optout = function() {
          document.cookie = "optout_ga=1; path=/; expires=" + new Date(new Date().getTime() + (60/*秒*/ * 60/*分*/ * 24/*時間*/ * 1000/*ミリ秒*/ * 3650/*日*/)).toGMTString();
          ngDialog.open({template: '<p>オプトアウトしました</p>',plain: true});
        }
      }]);
    </script>
</head>
<body>
    <h1>angulartics</h1>
    <button ng-click="optout()">オプトアウトする</button>
</body>
</html>
