<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.14.3/ui-bootstrap-tpls.min.js"></script>
    <title>Timepicker</title>
    <script>
        angular.module('MyApp', [])
        .directive("timepicker", function() {
            return {
                restrict: 'E',
                replace: true,
                templateUrl: 'timepicker.html',
                require: 'ngModel',
                scope: {
                    //required:'=',
                    hours:'&',  // & : 単方向バインディング(expression)
                    minutes:'&'
                },
                link: function(scope, element, attrs, ctrl) {
                    console.log(ctrl);
                    scope.hours = scope.hours();
                    if (!scope.hours) {
                        scope.hours = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];
                    }
                    scope.minutes = scope.minutes();
                    if (!scope.minutes) {
                        scope.minutes = [0,5,10,15,20,25,30,35,40,45,50,55];
                    }

                    var minuteOptions = [];
                    angular.forEach(scope.minutes, function(value) {
                        this.push({label:value >= 10? value : '0' + value,value:value});
                    }, minuteOptions);

                    scope.minutes = minuteOptions;

                    // TODO: ngModel support
                    scope.$watch("model", function(newValue){
                        if (newValue && Array.isArray(newValue)) {
                            scope.hour = newValue[0];
                            scope.minute = newValue[1];
                        } else {
                            scope.hour = null;
                            scope.minute = null;
                        }
                    });
                    scope.$watch("hour", function(newValue) {
                        if (newValue !== null) {
                            scope.model = [ newValue, scope.minute !== null? scope.minute : scope.minutes[0].value ];
                        } else {
                            scope.model = null;
                        }
                    });
                    scope.$watch("minute", function(newValue) {
                        if (newValue !== null) {
                            scope.model = [ scope.hour !== null? scope.hour : scope.hours[0], newValue ];
                        } else {
                            scope.model = null;
                        }
                    });
                }
            }
        })
        .run(["$rootScope", function($scope) {
            $scope.time1 = [ 12, 45 ];
            $scope.time2 = null;
        }]);

        angular.element(document).ready(function() { angular.bootstrap(document, ["MyApp"]); });
    </script>
</head>
<body>
<div class="container">
    <h1>TimePicker(時刻選択)</h1>
    time1: <timepicker class="timepicker" ng-model="time1" required="true"></timepicker> {{ time1 }}<br>
    time2: <timepicker class="timepicker" ng-model="time2" hours="[5,6,7,8,9,10,11,12]"></timepicker> {{ time2 }} <button type="button" ng-click="time2=null">クリア</button><br>
</div>
</body>
<script type="text/ng-template" id="timepicker.html">
    <span>
        <select ng-model="hour" ng-options="hour for hour in hours">
            <option value="">---</option>
        </select>
        時
        <select ng-model="minute" ng-options="minute.value as minute.label for minute in minutes">
            <option value="">---</option>
        </select>
        分
    </span>
</script>
</html>